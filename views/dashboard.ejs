<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AgriWeal Dashboard</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container my-4">
      <h1 class="mb-6">AgriWeal Dashboard</h1>
      <!-- Summary Cards -->
      <div class="row mb-4">
        <div class="col-md-3">
          <div class="card text-bg-primary mb-3 position-relative">
            <div class="card-body">
              <h5 class="card-title">
                Farmers
                <button
                  type="button"
                  class="btn btn-light btn-sm position-absolute top-0 end-0 m-2"
                  data-bs-toggle="modal"
                  data-bs-target="#addFarmerModal"
                >
                  +
                </button>
              </h5>
              <p class="card-text fs-2"><%= farmers ? farmers.length : 0 %></p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card text-bg-success mb-3 position-relative">
            <div class="card-body">
              <h5 class="card-title">
                Crops
                <button
                  type="button"
                  class="btn btn-light btn-sm position-absolute top-0 end-0 m-2"
                  data-bs-toggle="modal"
                  data-bs-target="#addCropModal"
                >
                  +
                </button>
              </h5>
              <p class="card-text fs-2"><%= crops ? crops.length : 0 %></p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card text-bg-warning mb-3 position-relative">
            <div class="card-body">
              <h5 class="card-title">
                Batches
                <button
                  type="button"
                  class="btn btn-light btn-sm position-absolute top-0 end-0 m-2"
                  data-bs-toggle="modal"
                  data-bs-target="#addBatchModal"
                >
                  +
                </button>
              </h5>
              <p class="card-text fs-1 fw-bold">
                <%= batches ? batches.length : 0 %>
              </p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card text-bg-info mb-3 position-relative">
            <div class="card-body">
              <h5 class="card-title">
                Seedling Purchases
                <button
                  type="button"
                  class="btn btn-light btn-sm position-absolute top-0 end-0 m-2"
                  data-bs-toggle="modal"
                  data-bs-target="#addPurchaseModal"
                >
                  +
                </button>
              </h5>
              <p class="card-text fs-2">
                <%= farmerBatches ? farmerBatches.length : 0 %>
              </p>
            </div>
          </div>
        </div>
      </div>
      <!-- Modals for Adding Data -->
      <!-- Add Farmer Modal -->
      <div
        class="modal fade"
        id="addFarmerModal"
        tabindex="-1"
        aria-labelledby="addFarmerModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <form action="/add-farmer" method="POST">
              <div class="modal-header">
                <h5 class="modal-title" id="addFarmerModalLabel">Add Farmer</h5>
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                  aria-label="Close"
                ></button>
              </div>
              <div class="modal-body">
                <div class="mb-3">
                  <label for="farmerName" class="form-label">Name</label>
                  <input
                    type="text"
                    class="form-control"
                    id="farmerName"
                    name="name"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="farmerPhone" class="form-label">Phone</label>
                  <input
                    type="text"
                    class="form-control"
                    id="farmerPhone"
                    name="phone"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="farmerEmail" class="form-label">Email</label>
                  <input
                    type="email"
                    class="form-control"
                    id="farmerEmail"
                    name="email"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="farmerLocation" class="form-label"
                    >Location</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="farmerLocation"
                    name="location"
                    required
                  />
                </div>
              </div>
              <div class="modal-footer">
                <button
                  type="button"
                  class="btn btn-secondary"
                  data-bs-dismiss="modal"
                >
                  Close
                </button>
                <button type="submit" class="btn btn-primary">
                  Add Farmer
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
      <!-- Add Crop Modal -->
      <div
        class="modal fade"
        id="addCropModal"
        tabindex="-1"
        aria-labelledby="addCropModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <form action="/add-crop" method="POST">
              <div class="modal-header">
                <h5 class="modal-title" id="addCropModalLabel">Add Crop</h5>
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                  aria-label="Close"
                ></button>
              </div>
              <div class="modal-body">
                <div class="mb-3">
                  <label for="cropName" class="form-label">Name</label>
                  <input
                    type="text"
                    class="form-control"
                    id="cropName"
                    name="name"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="nurseryDays" class="form-label"
                    >Nursery Days</label
                  >
                  <input
                    type="number"
                    class="form-control"
                    id="nurseryDays"
                    name="nursery_days"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="daysToHarvest" class="form-label"
                    >Days to Harvest</label
                  >
                  <input
                    type="number"
                    class="form-control"
                    id="daysToHarvest"
                    name="days_to_harvest"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="harvestDuration" class="form-label"
                    >Harvest Duration (days)</label
                  >
                  <input
                    type="number"
                    class="form-control"
                    id="harvestDuration"
                    name="harvest_duration_days"
                    required
                  />
                </div>
              </div>
              <div class="modal-footer">
                <button
                  type="button"
                  class="btn btn-secondary"
                  data-bs-dismiss="modal"
                >
                  Close
                </button>
                <button type="submit" class="btn btn-success">Add Crop</button>
              </div>
            </form>
          </div>
        </div>
      </div>
      <!-- Add Batch Modal -->
      <div
        class="modal fade"
        id="addBatchModal"
        tabindex="-1"
        aria-labelledby="addBatchModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <form action="/add-batch" method="POST">
              <div class="modal-header">
                <h5 class="modal-title" id="addBatchModalLabel">Add Batch</h5>
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                  aria-label="Close"
                ></button>
              </div>
              <div class="modal-body">
                <div class="mb-3">
                  <label for="batchCropId" class="form-label">Crop</label>
                  <select
                    class="form-select"
                    id="batchCropId"
                    name="crop_id"
                    required
                  >
                    <% if (crops && crops.length) { crops.forEach(crop => { %>
                    <option value="<%= crop.id %>"><%= crop.name %></option>
                    <% }) } %>
                  </select>
                </div>
                <div class="mb-3">
                  <label for="batchVariety" class="form-label">Variety</label>
                  <input
                    type="text"
                    class="form-control"
                    id="batchVariety"
                    name="variety"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="dateSown" class="form-label">Date Sown</label>
                  <input
                    type="date"
                    class="form-control"
                    id="dateSown"
                    name="date_sown"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="expectedTransplantDate" class="form-label"
                    >Expected Transplant Date</label
                  >
                  <input
                    type="date"
                    class="form-control"
                    id="expectedTransplantDate"
                    name="expected_transplant_date"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="expectedHarvestStart" class="form-label"
                    >Harvest Start</label
                  >
                  <input
                    type="date"
                    class="form-control"
                    id="expectedHarvestStart"
                    name="expected_harvest_start"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="expectedHarvestEnd" class="form-label"
                    >Harvest End</label
                  >
                  <input
                    type="date"
                    class="form-control"
                    id="expectedHarvestEnd"
                    name="expected_harvest_end"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="totalSeedlings" class="form-label"
                    >Total Seedlings</label
                  >
                  <input
                    type="number"
                    class="form-control"
                    id="totalSeedlings"
                    name="total_seedlings"
                    required
                  />
                </div>
              </div>
              <div class="modal-footer">
                <button
                  type="button"
                  class="btn btn-secondary"
                  data-bs-dismiss="modal"
                >
                  Close
                </button>
                <button type="submit" class="btn btn-warning">Add Batch</button>
              </div>
            </form>
          </div>
        </div>
      </div>
      <!-- Add Purchase Modal -->
      <div
      class="modal fade"
      id="addPurchaseModal"
      tabindex="-1"
      aria-labelledby="addPurchaseModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <form action="/add-purchase" method="POST">
            <div class="modal-header">
              <h5 class="modal-title" id="addPurchaseModalLabel">
                Add Seedling Purchase
              </h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <div class="mb-3">
                <label for="purchaseFarmerId" class="form-label"
                  >Farmer</label
                >
                <select
                  class="form-select"
                  id="purchaseFarmerId"
                  name="farmer_id"
                  required
                >
                  <% if (farmers && farmers.length) { farmers.forEach(farmer=> { %>
                  <option value="<%= farmer.id %>"><%= farmer.name %></option>
                  <% }) } %>
                </select>
              </div>
              <div class="mb-3">
                <label for="purchaseBatchId" class="form-label">Batch</label>
                <select
                  class="form-select"
                  id="purchaseBatchId"
                  name="batch_id"
                  required
                >
                  <% if (batches && batches.length) { batches.forEach(batch =>
                  { %>
                  <option value="<%= batch.id %>">
                    <%= batch.variety %> for <b>  <%= new Date(batch.expected_transplant_date).toLocaleDateString() %></b>
                  </option>
                  <% }) } %>
                </select>
              </div>
              <div class="mb-3">
                <label for="seedlingsBought" class="form-label"
                  >Seedlings Bought</label
                >
                <input
                  type="number"
                  class="form-control"
                  id="seedlingsBought"
                  name="seedlings_bought"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="datePurchased" class="form-label"
                  >Date Purchased</label
                >
                <input
                  type="date"
                  class="form-control"
                  id="datePurchased"
                  name="date_purchased"
                  required
                />
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Close
              </button>
              <button type="submit" class="btn btn-info">Add Purchase</button>
            </div>
          </form>
        </div>
      </div>
    </div>
      <!-- Farmers Table -->

      <h2>Farmers</h2>
      <div class="table-responsive mb-4">
        <table class="table table-bordered table-hover">
          <thead class="table-light">
            <tr>
              <th>ID</th>
              <th>Name</th>
              <th>Phone</th>
              <th>Email</th>
              <th>Location</th>
              <th>Created At</th>
            </tr>
          </thead>
          <tbody>
            <% if (farmers && farmers.length) { %> <% farmers.forEach(farmer =>
            { %>
            <tr>
              <td><%= farmer.id %></td>
              <td><%= farmer.name %></td>
              <td><%= farmer.phone %></td>
              <td><%= farmer.email %></td>
              <td><%= farmer.location %></td>
              <td><%= new Date(farmer.created_at).toLocaleDateString() %></td>
            </tr>
            <% }) %> <% } else { %>
            <tr>
              <td colspan="6" class="text-center">No farmers found.</td>
            </tr>
            <% } %>
          </tbody>
        </table>
      </div>
      <!-- Crops Table -->
      <h2>Crops</h2>
      <div class="table-responsive mb-4">
        <table class="table table-bordered table-hover">
          <thead class="table-light">
            <tr>
              <th>ID</th>
              <th>Name</th>
              <th>Nursery Days</th>
              <th>Days to Harvest</th>
              <th>Harvest Duration (days)</th>
            </tr>
          </thead>
          <tbody>
            <% if (crops && crops.length) { %> <% crops.forEach(crop => { %>
            <tr>
              <td><%= crop.id %></td>
              <td><%= crop.name %></td>
              <td><%= crop.nursery_days %></td>
              <td><%= crop.days_to_harvest %></td>
              <td><%= crop.harvest_duration_days %></td>
            </tr>
            <% }) %> <% } else { %>
            <tr>
              <td colspan="5" class="text-center">No crops found.</td>
            </tr>
            <% } %>
          </tbody>
        </table>
      </div>
      <!-- Batches Table -->
      <h2>Batches</h2>
      <div class="table-responsive mb-4">
        <table class="table table-bordered table-hover">
          <thead class="table-light">
            <tr>
              <th>ID</th>
              <th>Crop</th>
              <th>Variety</th>
              <th>Date Sown</th>
              <th>Expected Transplant</th>
              <th>Harvest Start</th>
              <th>Harvest End</th>
              <th>Total Seedlings</th>
            </tr>
          </thead>
          <tbody>
            <% if (batches && batches.length) { %> <% batches.forEach(batch => {
            %>
            <tr>
              <td><%= batch.id %></td>
              <td>
                <%= (crops && crops.find(c => c.id === batch.crop_id)?.name) ||
                'N/A' %>
              </td>
              <td><%= batch.variety %></td>
              <td><%= new Date(batch.date_sown).toLocaleDateString() %></td>
              <td>
                <%= new
                Date(batch.expected_transplant_date).toLocaleDateString() %>
              </td>
              <td>
                <%= new Date(batch.expected_harvest_start).toLocaleDateString()
                %>
              </td>
              <td>
                <%= new Date(batch.expected_harvest_end).toLocaleDateString() %>
              </td>
              <td><%= batch.total_seedlings %></td>
            </tr>
            <% }) %> <% } else { %>
            <tr>
              <td colspan="8" class="text-center">No batches found.</td>
            </tr>
            <% } %>
          </tbody>
        </table>
      </div>
      <!-- Farmer Batches Table -->
      <h2>Seedling Purchases</h2>
      <div class="table-responsive mb-4">
        <table class="table table-bordered table-hover">
          <thead class="table-light">
            <tr>
              <th>ID</th>
              <th>Farmer</th>
              <th>Batch</th>
              <th>Seedlings Bought</th>
              <th>Date Purchased</th>
            </tr>
          </thead>
          <tbody>
            <% if (farmerBatches && farmerBatches.length) { %> <%
            farmerBatches.forEach(fb => { %>
            <tr>
              <td><%= fb.id %></td>
              <td>
                <%= (farmers && farmers.find(f => f.id === fb.farmer_id)?.name)
                || 'N/A' %>
              </td>
              <td>
                <%= (batches && batches.find(b => b.id ===
                fb.batch_id)?.variety) || 'N/A' %>
              </td>
              <td><%= fb.seedlings_bought %></td>
              <td><%= new Date(fb.date_purchased).toLocaleDateString() %></td>
            </tr>
            <% }) %> <% } else { %>
            <tr>
              <td colspan="5" class="text-center">No purchases found.</td>
            </tr>
            <% } %>
          </tbody>
        </table>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
